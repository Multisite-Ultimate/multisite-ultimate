let _stripe,stripeElement,card,stripeElements=function(e){e=(_stripe=Stripe(e)).elements();card=e.create("card",{hidePostalCode:!0}),wp.hooks.addFilter("wu_before_form_submitted","nextpress/wp-ultimo",function(e,t,r){var o=document.getElementById("card-element");return"stripe"===r&&0<t.order.totals.total&&o&&o.offsetParent&&e.push(new Promise(async(e,t)=>{try{var r=await _stripe.createPaymentMethod({type:"card",card:card});r.error&&t(r.error)}catch(e){}e()})),e}),wp.hooks.addAction("wu_on_form_success","nextpress/wp-ultimo",function(e,t){"stripe"===e.gateway&&(0<e.order.totals.total||0<e.order.totals.recurring.total)&&(e.set_prevent_submission(!1),handlePayment(e,t,card))}),wp.hooks.addAction("wu_on_form_updated","nextpress/wp-ultimo",function(e){if("stripe"===e.gateway)try{card.mount("#card-element"),wu_stripe_update_styles(card,"#field-payment_template"),e.set_prevent_submission(e.order&&e.order.should_collect_payment&&"add-new"===e.payment_method)}catch(e){}else{e.set_prevent_submission(!1);try{card.unmount("#card-element")}catch(e){}}}),card.on("focus",function(){document.getElementById("card-element").classList.add("focused")}),card.on("blur",function(){document.getElementById("card-element").classList.remove("focused")})};function wu_stripe_update_styles(e,t){var r,t=document.querySelector(t);null===t||document.getElementById("wu-stripe-styles")||(t=window.getComputedStyle(t),(r=document.createElement("style")).innerHTML=".StripeElement {background-color:"+t.getPropertyValue("background-color")+";border-top-color:"+t.getPropertyValue("border-top-color")+";border-right-color:"+t.getPropertyValue("border-right-color")+";border-bottom-color:"+t.getPropertyValue("border-bottom-color")+";border-left-color:"+t.getPropertyValue("border-left-color")+";border-top-width:"+t.getPropertyValue("border-top-width")+";border-right-width:"+t.getPropertyValue("border-right-width")+";border-bottom-width:"+t.getPropertyValue("border-bottom-width")+";border-left-width:"+t.getPropertyValue("border-left-width")+";border-top-style:"+t.getPropertyValue("border-top-style")+";border-right-style:"+t.getPropertyValue("border-right-style")+";border-bottom-style:"+t.getPropertyValue("border-bottom-style")+";border-left-style:"+t.getPropertyValue("border-left-style")+";border-top-left-radius:"+t.getPropertyValue("border-top-left-radius")+";border-top-right-radius:"+t.getPropertyValue("border-top-right-radius")+";border-bottom-left-radius:"+t.getPropertyValue("border-bottom-left-radius")+";border-bottom-right-radius:"+t.getPropertyValue("border-bottom-right-radius")+";padding-top:"+t.getPropertyValue("padding-top")+";padding-right:"+t.getPropertyValue("padding-right")+";padding-bottom:"+t.getPropertyValue("padding-bottom")+";padding-left:"+t.getPropertyValue("padding-left")+";line-height:"+t.getPropertyValue("height")+";height:"+t.getPropertyValue("height")+";"+`display: flex;
    flex-direction: column;
    justify-content: center;`+"}",r.id="wu-stripe-styles",document.body.appendChild(r),e.update({style:{base:{color:t.getPropertyValue("color"),fontFamily:t.getPropertyValue("font-family"),fontSize:t.getPropertyValue("font-size"),fontWeight:t.getPropertyValue("font-weight"),fontSmoothing:t.getPropertyValue("-webkit-font-smoothing")}}}))}function wu_stripe_handle_intent(e,t,r){function o(e){wu_checkout_form.unblock(),e.error&&wu_checkout_form.errors.push(e.error)}try{_stripe[e](t,r).then(function(e){e.error?o(e):wu_checkout_form.resubmit()},o)}catch(e){}}function handlePayment(e,t,r){var o;t.gateway.data.stripe_client_secret&&(o="payment_intent"===t.gateway.data.stripe_intent_type?"confirmCardPayment":"confirmCardSetup",e={payment_method:"add-new"!==e.payment_method?e.payment_method:{card:r,billing_details:{name:t.customer.display_name,email:t.customer.user_email,address:{country:t.customer.billing_address_data.billing_country,postal_code:t.customer.billing_address_data.billing_zip_code}}}},wu_stripe_handle_intent(o,t.gateway.data.stripe_client_secret,e))}wp.hooks.addFilter("wu_before_form_init","nextpress/wp-ultimo",function(e){return e.add_new_card=wu_stripe.add_new_card,e.payment_method=wu_stripe.payment_method,e}),wp.hooks.addAction("wu_checkout_loaded","nextpress/wp-ultimo",function(){stripeElement=stripeElements(wu_stripe.pk_key)});